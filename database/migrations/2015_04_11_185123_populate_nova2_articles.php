<?php

use Illuminate\Database\Schema\Blueprint;
use Illuminate\Database\Migrations\Migration;

class PopulateNova2Articles extends Migration {

	/**
	 * Run the migrations.
	 *
	 * @return void
	 */
	public function up()
	{
		$articles = [
			['title' => "Installing Nova 2", 'slug' => "fresh-install", 'summary' => "", 'content' => "", 'tags' => [1, 3]],
			['title' => "Updating Nova 2", 'slug' => "update", 'summary' => "", 'content' => "## Backup\r\n\r\nBefore you attempt to update Nova 2, please make sure you backup both your files and database. While we don't anticipate any problems, if something does happen, you'll have a solid backup of your system to fall back to.\r\n\r\n## Remove\r\n\r\nOnce you've finished backing up all of your stuff, delete the <code>nova</code> directory in its entirety.\r\n\r\n<p class=\"alert alert-danger\">When we say delete, we mean it. Delete the directory and <strong>then</strong> upload the new copy.</p>## Upload\r\n\r\nWith the `nova` directory deleted, upload the directory from the zip archive you downloaded from the Anodyne site.\r\n\r\n## Update\r\n\r\nThe update process works just like the update process in Nova 1. The first step will try to do an automatic backup for you, but you don't have to worry about that too much since you manually backed up everything before you started. (You did back up everything before you started, right?)\r\n\r\nLet the update process do its thing and when you're done, you'll be back on the front Nova page and ready to use Nova again.", 'tags' => [1, 4]],
			['title' => "Upgrading From Nova 1 to Nova 2", 'slug' => "upgrade", 'summary' => "", 'content' => "", 'tags' => [1, 4]],
			['title' => "Backup Guide", 'slug' => "", 'summary' => "", 'content' => "", 'tags' => [2]],
			['title' => "Nova 2 Requirements", 'slug' => "requirements", 'summary' => "", 'content' => "We've worked hard to make sure Nova's requirements are as broad as possible so as many people as possible can use it for their games. Still, there are a few requirements that you should verify before installing Nova 2. In the event the server you're going to be installing Nova on doesn't support some or all of these things, you should contact your hosting provider and ask them about the possibility of upgrading these items.\r\n\r\n## PHP\r\n\r\nYou will need a server that is running PHP, a dynamic web development language that Nova is built in. Nova 2 requires that your server has at least __PHP 5.1.6__ installed. If you have less than 5.1 installed, the installation will fail and you won't be allowed to continue. Some of the new features in Nova 2 take advantage of functions and methods built in to PHP 5.1.\r\n\r\n## MySQL\r\n\r\nYou will need a server (and account) that has MySQL available. Nova is a database-driven system which means it needs a database (MySQL) to run. As long as you have __MySQL 4.1__ or higher, you should be fine. (Additionally, you can connect to MySQL through PHP's MySQLi functions if your hosting provider mentions that as an option.)\r\n\r\n## A Browser\r\n\r\nSince Nova is web-based software, you'll need a browser in order to use it. These days, there are a lot of browsers out there and most of them should work, but some of the older generation browser aren't supported because of their lack of support for technologies and tools used in Nova. Our recommendation is to use __Firefox__ (version 4 or higher) or a newer build of __Google Chrome__ (version 10 or higher). In addition, we also support Firefox 3, Safari 4 and higher as well as Internet Explorer 7 and higher. Make sure you have JavaScript turned on as many of Nova's features require it.\r\n\r\n<p class=\"alert alert-warning\">Due to Internet Explorer's shortcomings, there are known visual issues with Nova in IE 7. We have no intention of addressing these presentation issues and encourage you to use a standards-compliant browser such as Firefox, Google Chrome or Safari. These visual issues do not affect IE 8 and higher.</p>", 'tags' => [1]],
			['title' => "What's New in Nova 2.3", 'slug' => "", 'summary' => "", 'content' => "## Character Metadata Available on Manifests\r\n\r\nUse the new character metadata setting for each manifest to tell Nova which fields to pull out of the character information and display on your manifest. You can choose as many fields as you want to display, so make the manifest show more of the information your users are looking for.\r\n\r\n## Updates to Dynamic Forms\r\n\r\nNo one likes seeing blank fields on a bio, so we've updated the dynamic forms to only display fields that have something in them. This will make your forms cleaner and easier to read, especially for entries that don't have a lot of data. We've also added a much-requested feature of being able to show inline help for forms when in create or edit mode.\r\n\r\n## More Sim Stats\r\n\r\nGet a better view at the stats for your game over its entire lifetime now with the expansion of the sim stats. In addition to being able to see stats for the current and previous months, there are also new metrics for the overall lifetime of the game including total posts, average posts per month and more.", 'tags' => [4]],
			['title' => "What's New in Nova 2.2", 'slug' => "", 'summary' => "", 'content' => "## Character Bio Linking in Author Lists\r\n\r\nForum member Jordan Jay rolled out a MOD for Nova that added links to the character bio for the list of authors for a mission post. We loved this idea so much that we talked to Jordan about rolling the functionality into the Nova core! We've taken his idea and expanded on it though, so in addition to mission posts, the same linking behavior will happen on personal logs, news items, wiki pages and any comments that are entered throughout the system.\r\n\r\n## Reply To on Emails\r\n\r\nSince making changes to emails from Nova to combat emails being marked as spam by hosts, we've heared several people want us to set the Reply To header on email messages so that users can just hit reply and send an email back to the author of the post/log/news items. We've rolled this functionality into _most_ emails that come from Nova. In some cases, it doesn't make sense to have a Reply To header there (password resets were one of the emails we didn't think it didn't make sense for).\r\n\r\n<p class=\"alert alert-warning\"><strong>Note:</strong> Replying to an email will <strong>not</strong> post that item back into Nova. If you want to reply to an item or comment on it, you have to do so from inside Nova.</p>", 'tags' => [4]],
			['title' => "What's New in Nova 2.1", 'slug' => "", 'summary' => "", 'content' => "## Mission Note Update Notifications\r\n\r\nMission notes are an incredible useful feature that allow game masters to keep players updated on what's happening with the game, how players can best move things forward, and to give direction on how to post. The biggest challenge with mission notes though has always been accounting for the length of content (the big reason why notes are hidden by default). Users expressed concern that their updates to mission notes were going unnoticed by players because they didn't know changes had been made.\r\n\r\nNow, if mission notes have been updated within 72 hours, the mission notes content box will automatically be expanded and have an <span class=\"label label-warning\">UPDATED</span> label. If mission notes haven't been updated within 72 hours, the box will stay collapsed. Regardless of time though, the mission notes box will now always show the last time the notes were updated (unless, of course, they've never been updated).\r\n\r\n## Bug Fixes\r\n\r\n* The update page would always throw an error that it couldn't find Nova installed in the current database.\r\n* When a mission was updated, it was assumed mission notes updated as well. Now, there's greater precision in determining if the notes were actually updated.\r\n* Accepting or rejecting docking applications would throw a fatal error because the Messages model wasn't loaded before it was used.\r\n* Join timespan always showed as a user joining \"1 Second ago\" no matter when they joined.\r\n* Nova's `timespan_short` helper was missing the word \"ago\" when the time was less than an hour.\r\n* The Site Messages page didn't strip HTML tags from the content potentially allowing unclosed HTML tags to wreak havoc on the page.", 'tags' => [4]],
			['title' => "What's New in Nova 2.0", 'slug' => "", 'summary' => "", 'content' => "## New File Structure\r\n\r\nOne of the biggest reasons for doing Nova 2 was to improve the file structure of Nova. We've heard from people that updating Nova is difficult and time consuming. For a product that promises to \"get you back to playing your game\" that's unacceptable. We went back to the drawing board with our file structure to make sure updating Nova is dead simple and we think we've nailed it.\r\n\r\nWhen it comes time to update Nova, all you'll need to do is delete the `nova` directory and upload the newer copy. After that, just run the update script from your web browser like you would normally and you're done. No more wading through files and making sure you don't accidentally update a file you shouldn't. In, out and back to your game.\r\n\r\n## New Database Configuration Process\r\n\r\nTaking cues from SMS, Nova 2 includes a brand new database configuration process. Instead of having to open files up and edit them before starting the Nova 2 install, you'll simply go to the site and if there's no database configuration file, you'll be taken through a simple process that will collect your information and create the file for you. Before the file is created though, Nova will actually try to connect to the database and will let you know right away if something is wrong. We think this new process will make it easier and faster to get your game up and running on Nova 2.\r\n\r\n## Refreshed Default Look\r\n\r\nAfter a year and a half with the same default look, Nova 2 has gotten a facelift. Sporting an updated and simpler default interface, Nova 2 leverages HTML5 and CSS3 to a greater degree than previous versions of Nova. The old version of the skin will continue to work, but we felt that given the larger nature of the changes, a refreshed look and feel was appropriate.\r\n\r\n## Thresher R2\r\n\r\nBy far, the majority of our focus has been on Thresher and getting it up to Release 2. There are a ton of improvements to our mini-wiki that will make using it even better than before.\r\n\r\n### System Pages\r\n\r\nPeople told us they wanted more control of some of the static content in Thresher and we came up with a solution that does just that. System pages are specialized wiki pages that cannot be deleted but can be edited like any other wiki page. Make the front Thresher page just what you want by editing the system page in the same place you'd edit a normal wiki page. In addition to the main page, we've added system pages for the all categories listing page, individual category page and creating and editing pages.\r\n\r\n### Page Restrictions\r\n\r\nHave a page that only a few people should be able to get to? In Thresher R1, you were out of luck. In Thresher R2, you can simply set access level restrictions on the page and only those access levels will be able to see them.\r\n\r\n### Brand New Category Selection Interface\r\n\r\nLet's be honest, a list of checkboxes wasn't much of an interface for selecting categories. Now, a more elegant solution makes it easier to categorize your pages.\r\n\r\n### Create Categories On-the-Fly\r\n\r\nAnother one of the big things users told us they wanted to be able to do was to create categories right from the create/edit page. Now you can. Don't have a category for what you want? Just create it then select it and your page will be using that category. Just getting started with Thresher and don't have any categories yet? Don't worry, Thresher will prompt you to create some categories right on the page.\r\n\r\n### User Experience Improvements\r\n\r\nWe're always looking to make the user experience of our products better than before. In Thresher R2, we've made viewing a wiki page a much better and simpler experience. In addition, we've overhauled the Manage Pages section with a whole new user interface that puts more controls at admins fingertips and allows filtering pages by restrictions, the type of page and more.\r\n\r\n### Better Searching\r\n\r\nThis one is pretty self-explanatory. We've worked out several bugs that existed in the search features for Thresher so that you'll get more accurate search results. In addition, we've brought search front and center on the main page with an option to search the minute you land in Thresher.\r\n\r\n## Simplified Character/User Management\r\n\r\nOne of Nova 1's major features was the separation of users and characters, allowing a single user to control multiple characters. While this was a great feature, the management piece was a bit of a struggle for a lot of admins. It was all-to-easy to deactivate a character but leave the user active or vice versa. To help with this management headache, we've borrowed from Nova 3's planned features to provide a dead-simple way to manage characters and users. If you want to take action on a character (activate, deactivate, make an NPC or make an NPC a playing character), admins will do so now with a series of buttons:\r\n\r\n* __Activating an Inactive Character__ - Only displayed with inactive characters, this button will not only activate an inactive character, but will also give admins the ability to activate the user if they're inactive, make the character the primary character for the user or even assign the character to a completely different user.\r\n* __Deactivating an Active Character__ - Only displayed with active characters, this button will deactivate the active character and check the user for any other active characters. If the user doesn't have any other active characters, admins will have an option to deactivate the user right then and there. If the user does have other characters and the one being deactivated is their main character, a dropdown menu will allow admins to set a new main character for that user.\r\n* __Making an Active or Inactive Character an NPC__ - Displayed for both active and inactive characters, this button will move an active or inactive character to be an NPC. If the character in question is someone's main character, a dropdown menu will allow admins to set a new main character for that user. The character will continue to be associated with that user even as an NPC unless the admins selects the option to clear the user association. In the event that making an active character an NPC leaves a user without an active character, admins will have the option to deactivate the user as well.\r\n* __Making an NPC an Active Character__ - Only displayed for non-playing characters, this button will move an NPC to be an active character. Admins will be able to associate the character with a user or change the user the character is associated with in addition to setting the character to be the primary character. In the event a character is being associated with an inactive user, the option will be given to activate that user.\r\n* __Activating a User__ - Only displayed for inactive user accounts, this button will activate an inactive user as well providing admins with the ability to activate any of that user's inactive characters at the same time.\r\n* __Deactivating a User__ - Only displayed for active user accounts, this button will deactivate an active user as well as deactivate all of their active characters.\r\n\r\n## Nested Mission Groups\r\n\r\nOne of the final additions to Nova 1 was mission groups as a way to pull missions together. After seeing how people are using the feature, we've expanded mission groups to allow them to be nested down one level. This means you can now have groups inside groups. Along with this, we've completely re-written the user interface for viewing mission groups which will give users more information at a glance than before.\r\n\r\n## Brand-New Character Selection\r\n\r\nOn pages where you can select multiple characters (writing a mission post, editing a mission post, writing a private message, etc.), the UI was never that good. Select a user and click a link. Select another user and click a link. It was bulky and quite a pain to maintain. In Nova 2, we've changed the UI to be a lot more friendly. Now, just start typing a character name and the list will filter for you. Click the name and you're done. Want to remove a character from the list? Just click on the X next to their name.\r\n\r\n## Updates to Site Messages\r\n\r\nOne of the biggest complaints about Nova is that it makes adding content more difficult than it needs to be. For us, it's always been a security issue to allow script, audio, video, iframe and object tags in the site messages. There are just too many documented cases of people using those for malicious purposes. Sadly, our focus on security made it more difficult for games to do the things they could do before with SMS. That shouldn't be the case. Because of that, we've relented on this issue and now allow all of the previously disallowed HTML tags in site messages. That means that games can now link to YouTube and Vimeo media without having to use seamless substitution. We think this is a big win for our users, though it does come at a cost. You should make sure you absolutely trust the source of any code you put in to your site messages so there are no security issues.\r\n\r\n## Deck Listing Updates\r\n\r\nThe deck listing page received several much-needed user interface updates for Nova 2.\r\n\r\nThe first change you'll notice on the deck listing page is the new menu at the top that will let you quickly move from item to item without having to scroll forever. Games that have a lot of decks in their deck listing will find this especially handy.\r\n\r\nThe second change is that decks are now displayed outside of a table. The previous table-based layout made the page look messy. Without tables, the deck listing flows a little better and makes it significantly easier to read, especially for games with lots of decks and even more content.\r\n\r\n## Post Locking\r\n\r\nOne of the most requested features since SMS 2 was the ability to \"lock\" a post when someone was working on it so that another user couldn't come in and overwrite the work being done. This was a tricky request and one that took a lot of time to come up with a good solution, but we've done it. Post locking relies on a very simple premise: when you start editing a post, no one else can edit it until you're done.\r\n\r\nOf course, it's significantly more complicated than that, but that's the basic idea. When you edit a post, you're granted a 5 minute lock. After 5 minutes, Nova will check to see if you're still editing the post. If you are, it'll renew the lock for another 5 minutes, but if you've walked away and left the page up, it'll auto-save your work and then release the lock. If you go to a post that's locked, you'll see a notification the post is locked and you won't be able to edit anything.\r\n\r\n## Top Open Positions\r\n\r\nSometimes, you want to highlight a few open positions to prospective players, but the open positions listing can be daunting, especially if you have a lot of positions open. Now, the top open positions listing makes it easier to nudge prospective players toward the positions you want to fill. To get started, simply update the position you want to highlight and change the Top Open Position option to Yes. The next time you go to the manifest and click on Open Positions, a new section will appear at the top of the manifest that highlights those top open positions.\r\n\r\n## Rules\r\n\r\nReturning from the ashes of SMS 2, Nova now includes a dedicated rules page that admins can update from Site Messages.\r\n\r\n## Bug Fixes\r\n\r\nAs with any update, we've taken time to fix several nagging issues in Nova, some of which have existed from the very beginning. In all, we've address over a dozen bugs to make your experience with Nova 2 even better than with version 1. Some of the major issues addressed include:\r\n\r\n* Using seamless substitution with images in the <code>_base_override</code> directory didn't work properly\r\n* When replying to or forwarding private messages, the RE and FWD prefixes would always be added to the subject line instead of just once\r\n* When replying to a private message, the person sending the message would end up on the recipient list and the message would appear in their inbox\r\n* The join form could be submitted without an email address and password\r\n* Users who were deactivated kept their system flags (webmaster, system administrator, game master, etc.)\r\n* Reactivated users didn't have their access role properly set\r\n* Inactive users saw a link to upload images even though they don't have permission to do so\r\n* Users could reset their password without needing a security question\r\n* Open slots for positions always weren't properly updated when a character was deactivated\r\n* Pulsar and Titan didn't always display properly in Internet Explorer 9\r\n* The \"Nominated By\" line was shown even when there was no nominee (only an issue for people who upgraded from SMS)\r\n* The Enterprise genre file had several issues\r\n* Patched several potential security issues\r\n* Much more...", 'tags' => [4]],
		];

		foreach ($articles as $article)
		{
			$article['product_id'] = 2;
			$article['user_id'] = 1;

			$tags = (array_key_exists('tags', $article)) ? $article['tags'] : null;
			unset($article['tags']);

			$item = Article::create($article);

			if ($tags)
			{
				$item->tags()->sync($tags);
			}
		}
	}

	/**
	 * Reverse the migrations.
	 *
	 * @return void
	 */
	public function down()
	{
		Article::where('product_id', 2)->delete();
	}

}
